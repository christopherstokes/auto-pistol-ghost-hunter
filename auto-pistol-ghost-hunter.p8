pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--main funcs

function _init()
	tme=0
	
	friction=0.95
	
	-- directions
	dirx={-1,1,0,0}
	diry={0,0,-1,1}
	
	player_init()
	
	zmb_run=new_anim({34,35,36,35},15,1,2)
	zmb_x=48
	zmb_y=-32
	
	gst_run=new_anim({32,33})
	gst_x=-32
	gst_y=96
	
	skl_run=new_anim({48,49})
	skl_x=160
	skl_y=32
end

function _update60()
	upd_anim(pl.anims[pl.ca])
	upd_anim(zmb_run)
	upd_anim(gst_run)
	upd_anim(skl_run)
	
	zmb_y+=0.25
	if(zmb_y>128)zmb_y=-32
	
	gst_x+=0.30
	if(gst_x>128)gst_x=-32
	
	skl_x-=0.30
	if(skl_x<-8)skl_x=160
	
	pl.upd()

	tme+=1
end

function _draw()
	cls(9)
	drw_anim(pl.x,pl.y,pl.anims[pl.ca],pl.flp)
	drw_anim(zmb_x,zmb_y,zmb_run)
	drw_anim(gst_x,gst_y,gst_run)
	drw_anim(skl_x,skl_y,skl_run,true)
end
-->8
--animations

function new_anim(_f,_t,_w,_h)
	return {
		f=_f or {},
		t=_t or 15,
		w=_w or 1,
		h=_h or 1,
		cf=1	
	}
end

function	upd_anim(anim)
	if tme%anim.t==0 then
		anim.cf+=1
	end
	if(anim.cf>#anim.f)anim.cf=1
end

function drw_anim(_x,_y,_anim,_flp)
	local flp=_flp or nil
	ospr(_anim.f[_anim.cf],_x,_y,_anim.w,_anim.h,flp,0)
end
-->8
--tools

function ospr(_n,_x,_y,_w,_h,_flp,_oc)
	pal(10,_oc)
	for i=1,4 do
		spr(_n,_x+dirx[i],_y+diry[i],_w,_h,_flp)
	end
	pal()
	spr(_n,_x,_y,_w,_h,_flp)
end

function sortbyy(a)
	for i=1,#a do
		local j = i
		while j > 1 and a[j-1].y > a[j].y do
		  a[j],a[j-1] = a[j-1],a[j]
		  j = j - 1
		end
	end
end
-->8
--actors

function new_actor()
end

function recycle_actor()
end

-- not sure
function add_component()
end

function upd_actor()
end
-->8
--components

mover={}
exploder={}
shooter={}
blocker={}
chaser={}
healer={}

function mover.init(_a)
	function	_a:move(dx,dy)
		self.x+=dx
		self.y+=dy
	end
end

function exploder.init()
end

function shooter.init()
end

function blocker.init()
end

function chaser.init()
end

function healer.init()
end
-->8
-- player
function player_init()
	pl={
		x=64,
		y=64,
		spd=0.5,
		acc=0.035,
		dx=0,
		dy=0,
		anims={
			idle=new_anim({1,2},15,1,2)
			,move=new_anim({2,3,2,4},10,1,2)
		},
		ca="idle",
		flp=false
	}
	
	mover.init(pl)
	
	function pl.upd()
		pl.dx*=friction
		pl.dy*=friction
	
		if btn(⬅️) then 
		 pl.flp=true
		 pl.dx-=pl.acc
		end
		if btn(➡️) then
			pl.flp=false
			pl.dx+=pl.acc
		end
		if btn(⬆️) then
			pl.dy-=pl.acc
		end
		if btn(⬇️) then
			pl.dy+=pl.acc
		end
		
		if(pl.dx>pl.spd)pl.dx=pl.spd
		if(pl.dx<-pl.spd)pl.dx=-pl.spd
		if(pl.dy>pl.spd)pl.dy=pl.spd
		if(pl.dy<-pl.spd)pl.dy=-pl.spd
		
		if (pl.dy==0 and pl.dx==0) then
			pl.ca="idle"
		else
			pl.ca="move"
			pl:move(pl.dx,pl.dy)
		end
	end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaa0000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000aa0000aaaaaa00000aa00000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000aa000000aa00000aaaaaa0aaaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaaa0a00aaaa0a0000aa00000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaa00aaaaaa000aaaaa0a0aaaaa0a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaa00aaaaaa00aaaaaaa0aaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaa00aaaaaa00aaaaaaa0aaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aa00aa00aa00aa00aaaaaaa0aaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a00a0000a00a000aa000aa0aa000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a00a0000a00a0000a000a000a000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a00a0000a00a0000a000a000a000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a00a0000a00a0000000a00000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a00a0000a00a0000000a00000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aa00aa00aa00aa000000aa000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaaaaa00a000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aa00a000aaaaaaaa000aa00000000000000aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aa00a000aaaaaaaa000aa000000aa000000aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaaaaa00aaaaaaaa000aa000000aa000000aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaaaaa000a0a0a0aa0aaaa00000aa00000aaaa0a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaaaaa0000000000aaaaaa0aa0aaaa0aa0aaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a0a0a0a0000000000aaaaaaa0aaaaaa0aaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaaaaa000aaaa000aaaaaa000aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0aaaaa00aa00a00a00aaaa0000aaaa0000aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aa0aa0a0aaaaaaaa00a00a0000aaaa0000a00a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aa0aa0a0a0a0a0a000a00a000a0000a000a00a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaaaaaa0a0000000000a0a000a0000a000a0a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aa0a0a000aaaaa00000a0a000a0000a000a0a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a00000000000000000000a0000a00a0000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0aaaa0000000000000000a0000a00a0000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
